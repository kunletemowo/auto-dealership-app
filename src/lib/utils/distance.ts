/**
 * Utility functions for calculating distances between coordinates
 */

/**
 * Calculate the distance between two points on Earth using the Haversine formula
 * Returns distance in kilometers
 * 
 * @param lat1 Latitude of first point
 * @param lon1 Longitude of first point
 * @param lat2 Latitude of second point
 * @param lon2 Longitude of second point
 * @returns Distance in kilometers
 */
export function calculateDistance(
  lat1: number,
  lon1: number,
  lat2: number,
  lon2: number
): number {
  const R = 6371; // Earth's radius in kilometers
  const dLat = toRadians(lat2 - lat1);
  const dLon = toRadians(lon2 - lon1);

  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRadians(lat1)) *
      Math.cos(toRadians(lat2)) *
      Math.sin(dLon / 2) *
      Math.sin(dLon / 2);

  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  const distance = R * c;

  return distance;
}

/**
 * Convert degrees to radians
 */
function toRadians(degrees: number): number {
  return degrees * (Math.PI / 180);
}

/**
 * Get coordinates for a location (city, region, or postal code)
 * This is a simplified lookup - in production, you'd use a geocoding API
 */
export function getLocationCoordinates(location: string): {
  latitude: number;
  longitude: number;
} | null {
  // Comprehensive lookup for Canadian cities with coordinates
  // In production, use a geocoding service like Google Maps API, Mapbox, or Canada Post API
  const locationMap: Record<string, { latitude: number; longitude: number }> = {
    // Ontario (ON)
    "toronto, on": { latitude: 43.6532, longitude: -79.3832 },
    "toronto, ontario": { latitude: 43.6532, longitude: -79.3832 },
    "ottawa, on": { latitude: 45.4215, longitude: -75.6972 },
    "ottawa, ontario": { latitude: 45.4215, longitude: -75.6972 },
    "mississauga, on": { latitude: 43.589, longitude: -79.6441 },
    "mississauga, ontario": { latitude: 43.589, longitude: -79.6441 },
    "brampton, on": { latitude: 43.7315, longitude: -79.7624 },
    "brampton, ontario": { latitude: 43.7315, longitude: -79.7624 },
    "hamilton, on": { latitude: 43.2557, longitude: -79.8711 },
    "hamilton, ontario": { latitude: 43.2557, longitude: -79.8711 },
    "london, on": { latitude: 42.9849, longitude: -81.2453 },
    "london, ontario": { latitude: 42.9849, longitude: -81.2453 },
    "markham, on": { latitude: 43.8561, longitude: -79.337 },
    "markham, ontario": { latitude: 43.8561, longitude: -79.337 },
    "vaughan, on": { latitude: 43.8361, longitude: -79.4982 },
    "vaughan, ontario": { latitude: 43.8361, longitude: -79.4982 },
    "kitchener, on": { latitude: 43.4516, longitude: -80.4925 },
    "kitchener, ontario": { latitude: 43.4516, longitude: -80.4925 },
    "windsor, on": { latitude: 42.3149, longitude: -83.0364 },
    "windsor, ontario": { latitude: 42.3149, longitude: -83.0364 },
    "oshawa, on": { latitude: 43.8975, longitude: -78.8658 },
    "oshawa, ontario": { latitude: 43.8975, longitude: -78.8658 },
    "oakville, on": { latitude: 43.4675, longitude: -79.6877 },
    "oakville, ontario": { latitude: 43.4675, longitude: -79.6877 },
    "richmond hill, on": { latitude: 43.8828, longitude: -79.4403 },
    "richmond hill, ontario": { latitude: 43.8828, longitude: -79.4403 },
    "burlington, on": { latitude: 43.3255, longitude: -79.799 },
    "burlington, ontario": { latitude: 43.3255, longitude: -79.799 },
    "st. catharines, on": { latitude: 43.1594, longitude: -79.2469 },
    "st. catharines, ontario": { latitude: 43.1594, longitude: -79.2469 },
    "st catharines, on": { latitude: 43.1594, longitude: -79.2469 },
    "st catharines, ontario": { latitude: 43.1594, longitude: -79.2469 },
    "cambridge, on": { latitude: 43.3616, longitude: -80.3144 },
    "cambridge, ontario": { latitude: 43.3616, longitude: -80.3144 },
    "guelph, on": { latitude: 43.5448, longitude: -80.2482 },
    "guelph, ontario": { latitude: 43.5448, longitude: -80.2482 },
    "barrie, on": { latitude: 44.3894, longitude: -79.6903 },
    "barrie, ontario": { latitude: 44.3894, longitude: -79.6903 },
    "kingston, on": { latitude: 44.2312, longitude: -76.486 },
    "kingston, ontario": { latitude: 44.2312, longitude: -76.486 },
    "thunder bay, on": { latitude: 48.3809, longitude: -89.2477 },
    "thunder bay, ontario": { latitude: 48.3809, longitude: -89.2477 },
    "sudbury, on": { latitude: 46.4927, longitude: -81.0078 },
    "sudbury, ontario": { latitude: 46.4927, longitude: -81.0078 },
    "waterloo, on": { latitude: 43.4643, longitude: -80.5204 },
    "waterloo, ontario": { latitude: 43.4643, longitude: -80.5204 },
    "ajax, on": { latitude: 43.8501, longitude: -79.0209 },
    "ajax, ontario": { latitude: 43.8501, longitude: -79.0209 },
    "whitby, on": { latitude: 43.8975, longitude: -78.9428 },
    "whitby, ontario": { latitude: 43.8975, longitude: -78.9428 },
    "pickering, on": { latitude: 43.8374, longitude: -79.0868 },
    "pickering, ontario": { latitude: 43.8374, longitude: -79.0868 },
    "sarnia, on": { latitude: 42.9744, longitude: -82.4066 },
    "sarnia, ontario": { latitude: 42.9744, longitude: -82.4066 },
    "peterborough, on": { latitude: 44.3011, longitude: -78.3161 },
    "peterborough, ontario": { latitude: 44.3011, longitude: -78.3161 },
    "belleville, on": { latitude: 44.1628, longitude: -77.3832 },
    "belleville, ontario": { latitude: 44.1628, longitude: -77.3832 },
    "niagara falls, on": { latitude: 43.0962, longitude: -79.0377 },
    "niagara falls, ontario": { latitude: 43.0962, longitude: -79.0377 },
    "brantford, on": { latitude: 43.1394, longitude: -80.2644 },
    "brantford, ontario": { latitude: 43.1394, longitude: -80.2644 },
    "newmarket, on": { latitude: 44.0524, longitude: -79.4634 },
    "newmarket, ontario": { latitude: 44.0524, longitude: -79.4634 },
    "cornwall, on": { latitude: 45.0189, longitude: -74.7281 },
    "cornwall, ontario": { latitude: 45.0189, longitude: -74.7281 },
    "milton, on": { latitude: 43.5183, longitude: -79.8774 },
    "milton, ontario": { latitude: 43.5183, longitude: -79.8774 },
    "st. thomas, on": { latitude: 42.7779, longitude: -81.1827 },
    "st. thomas, ontario": { latitude: 42.7779, longitude: -81.1827 },
    "st thomas, on": { latitude: 42.7779, longitude: -81.1827 },
    "st thomas, ontario": { latitude: 42.7779, longitude: -81.1827 },
    "woodstock, on": { latitude: 43.1300, longitude: -80.7497 },
    "woodstock, ontario": { latitude: 43.1300, longitude: -80.7497 },
    "welland, on": { latitude: 42.9925, longitude: -79.2481 },
    "welland, ontario": { latitude: 42.9925, longitude: -79.2481 },
    "north bay, on": { latitude: 46.3092, longitude: -79.4608 },
    "north bay, ontario": { latitude: 46.3092, longitude: -79.4608 },
    "orillia, on": { latitude: 44.6068, longitude: -79.4206 },
    "orillia, ontario": { latitude: 44.6068, longitude: -79.4206 },
    "timmins, on": { latitude: 48.4758, longitude: -81.3305 },
    "timmins, ontario": { latitude: 48.4758, longitude: -81.3305 },
    "chatham, on": { latitude: 42.4056, longitude: -82.1831 },
    "chatham, ontario": { latitude: 42.4056, longitude: -82.1831 },
    "sault ste. marie, on": { latitude: 46.5248, longitude: -84.3298 },
    "sault ste. marie, ontario": { latitude: 46.5248, longitude: -84.3298 },
    "sault ste marie, on": { latitude: 46.5248, longitude: -84.3298 },
    "sault ste marie, ontario": { latitude: 46.5248, longitude: -84.3298 },
    "owen sound, on": { latitude: 44.5676, longitude: -80.9430 },
    "owen sound, ontario": { latitude: 44.5676, longitude: -80.9430 },
    "bradford, on": { latitude: 44.1168, longitude: -79.5664 },
    "bradford, ontario": { latitude: 44.1168, longitude: -79.5664 },
    "stratford, on": { latitude: 43.3700, longitude: -80.9814 },
    "stratford, ontario": { latitude: 43.3700, longitude: -80.9814 },
    "owen sound, on": { latitude: 44.5676, longitude: -80.9430 },
    "owen sound, ontario": { latitude: 44.5676, longitude: -80.9430 },
    "owens sound, on": { latitude: 44.5676, longitude: -80.9430 },
    "owens sound, ontario": { latitude: 44.5676, longitude: -80.9430 },
    "kawartha lakes, on": { latitude: 44.3517, longitude: -78.7472 },
    "kawartha lakes, ontario": { latitude: 44.3517, longitude: -78.7472 },
    "kawartha lakes city, on": { latitude: 44.3517, longitude: -78.7472 },
    "kawartha lakes city, ontario": { latitude: 44.3517, longitude: -78.7472 },
    "lindsay, on": { latitude: 44.3547, longitude: -78.7356 },
    "lindsay, ontario": { latitude: 44.3547, longitude: -78.7356 },
    "orangeville, on": { latitude: 43.9208, longitude: -80.0986 },
    "orangeville, ontario": { latitude: 43.9208, longitude: -80.0986 },
    "aurora, on": { latitude: 44.0000, longitude: -79.4667 },
    "aurora, ontario": { latitude: 44.0000, longitude: -79.4667 },
    "georgina, on": { latitude: 44.3000, longitude: -79.4333 },
    "georgina, ontario": { latitude: 44.3000, longitude: -79.4333 },
    "new tecumseth, on": { latitude: 44.0867, longitude: -79.7611 },
    "new tecumseth, ontario": { latitude: 44.0867, longitude: -79.7611 },
    "alliston, on": { latitude: 44.1500, longitude: -79.8667 },
    "alliston, ontario": { latitude: 44.1500, longitude: -79.8667 },
    "collingwood, on": { latitude: 44.5000, longitude: -80.2167 },
    "collingwood, ontario": { latitude: 44.5000, longitude: -80.2167 },
    "wasaga beach, on": { latitude: 44.5167, longitude: -80.0167 },
    "wasaga beach, ontario": { latitude: 44.5167, longitude: -80.0167 },
    "owen sound, on": { latitude: 44.5676, longitude: -80.9430 },
    "owen sound, ontario": { latitude: 44.5676, longitude: -80.9430 },
    "parry sound, on": { latitude: 45.3431, longitude: -80.0364 },
    "parry sound, ontario": { latitude: 45.3431, longitude: -80.0364 },
    "bracebridge, on": { latitude: 45.0333, longitude: -79.3167 },
    "bracebridge, ontario": { latitude: 45.0333, longitude: -79.3167 },
    "gravenhurst, on": { latitude: 44.9167, longitude: -79.3667 },
    "gravenhurst, ontario": { latitude: 44.9167, longitude: -79.3667 },
    "huntsville, on": { latitude: 45.3269, longitude: -79.2167 },
    "huntsville, ontario": { latitude: 45.3269, longitude: -79.2167 },
    "cottam, on": { latitude: 42.1167, longitude: -82.7333 },
    "cottam, ontario": { latitude: 42.1167, longitude: -82.7333 },
    "leamington, on": { latitude: 42.0500, longitude: -82.5833 },
    "leamington, ontario": { latitude: 42.0500, longitude: -82.5833 },
    "amherstburg, on": { latitude: 42.1000, longitude: -83.1000 },
    "amherstburg, ontario": { latitude: 42.1000, longitude: -83.1000 },
    "la salle, on": { latitude: 42.2167, longitude: -83.0667 },
    "la salle, ontario": { latitude: 42.2167, longitude: -83.0667 },
    "tecumseh, on": { latitude: 42.3167, longitude: -82.9000 },
    "tecumseh, ontario": { latitude: 42.3167, longitude: -82.9000 },
    "essex, on": { latitude: 42.1750, longitude: -82.8167 },
    "essex, ontario": { latitude: 42.1750, longitude: -82.8167 },
    "kingsville, on": { latitude: 42.0333, longitude: -82.7333 },
    "kingsville, ontario": { latitude: 42.0333, longitude: -82.7333 },
    "tillsonburg, on": { latitude: 42.8594, longitude: -80.7269 },
    "tillsonburg, ontario": { latitude: 42.8594, longitude: -80.7269 },
    "ingersoll, on": { latitude: 43.0333, longitude: -80.8833 },
    "ingersoll, ontario": { latitude: 43.0333, longitude: -80.8833 },
    "st. marys, on": { latitude: 43.2583, longitude: -81.1417 },
    "st. marys, ontario": { latitude: 43.2583, longitude: -81.1417 },
    "st marys, on": { latitude: 43.2583, longitude: -81.1417 },
    "st marys, ontario": { latitude: 43.2583, longitude: -81.1417 },
    "strathroy, on": { latitude: 42.9583, longitude: -81.6250 },
    "strathroy, ontario": { latitude: 42.9583, longitude: -81.6250 },
    "goderich, on": { latitude: 43.7428, longitude: -81.7136 },
    "goderich, ontario": { latitude: 43.7428, longitude: -81.7136 },
    "clinton, on": { latitude: 43.6167, longitude: -81.5333 },
    "clinton, ontario": { latitude: 43.6167, longitude: -81.5333 },
    "wingham, on": { latitude: 43.8833, longitude: -81.3167 },
    "wingham, ontario": { latitude: 43.8833, longitude: -81.3167 },
    "hanover, on": { latitude: 44.1500, longitude: -81.0333 },
    "hanover, ontario": { latitude: 44.1500, longitude: -81.0333 },
    "walkerton, on": { latitude: 44.1333, longitude: -81.1500 },
    "walkerton, ontario": { latitude: 44.1333, longitude: -81.1500 },
    "mount forest, on": { latitude: 43.9833, longitude: -80.7333 },
    "mount forest, ontario": { latitude: 43.9833, longitude: -80.7333 },
    "fergus, on": { latitude: 43.7056, longitude: -80.3781 },
    "fergus, ontario": { latitude: 43.7056, longitude: -80.3781 },
    "elora, on": { latitude: 43.6833, longitude: -80.4333 },
    "elora, ontario": { latitude: 43.6833, longitude: -80.4333 },
    "erin, on": { latitude: 43.7667, longitude: -80.0667 },
    "erin, ontario": { latitude: 43.7667, longitude: -80.0667 },
    "georgetown, on": { latitude: 43.6500, longitude: -79.9333 },
    "georgetown, ontario": { latitude: 43.6500, longitude: -79.9333 },
    "acton, on": { latitude: 43.6333, longitude: -80.0333 },
    "acton, ontario": { latitude: 43.6333, longitude: -80.0333 },
    "halton hills, on": { latitude: 43.6500, longitude: -79.9333 },
    "halton hills, ontario": { latitude: 43.6500, longitude: -79.9333 },
    "bolton, on": { latitude: 43.8833, longitude: -79.7333 },
    "bolton, ontario": { latitude: 43.8833, longitude: -79.7333 },
    "caledon, on": { latitude: 43.8667, longitude: -79.8667 },
    "caledon, ontario": { latitude: 43.8667, longitude: -79.8667 },
    "orangeville, on": { latitude: 43.9208, longitude: -80.0986 },
    "orangeville, ontario": { latitude: 43.9208, longitude: -80.0986 },
    "shelburne, on": { latitude: 44.0833, longitude: -80.2000 },
    "shelburne, ontario": { latitude: 44.0833, longitude: -80.2000 },
    "dundas, on": { latitude: 43.2667, longitude: -79.9500 },
    "dundas, ontario": { latitude: 43.2667, longitude: -79.9500 },
    "ancaster, on": { latitude: 43.2250, longitude: -79.9833 },
    "ancaster, ontario": { latitude: 43.2250, longitude: -79.9833 },
    "stoney creek, on": { latitude: 43.2167, longitude: -79.7667 },
    "stoney creek, ontario": { latitude: 43.2167, longitude: -79.7667 },
    "grimsby, on": { latitude: 43.2000, longitude: -79.5667 },
    "grimsby, ontario": { latitude: 43.2000, longitude: -79.5667 },
    "beamsville, on": { latitude: 43.1833, longitude: -79.4833 },
    "beamsville, ontario": { latitude: 43.1833, longitude: -79.4833 },
    "vineland, on": { latitude: 43.1500, longitude: -79.4000 },
    "vineland, ontario": { latitude: 43.1500, longitude: -79.4000 },
    "port colborne, on": { latitude: 42.8833, longitude: -79.2500 },
    "port colborne, ontario": { latitude: 42.8833, longitude: -79.2500 },
    "fort erie, on": { latitude: 42.9167, longitude: -79.0167 },
    "fort erie, ontario": { latitude: 42.9167, longitude: -79.0167 },
    "crystal beach, on": { latitude: 42.8667, longitude: -79.0667 },
    "crystal beach, ontario": { latitude: 42.8667, longitude: -79.0667 },
    "penetanguishene, on": { latitude: 44.7833, longitude: -79.9333 },
    "penetanguishene, ontario": { latitude: 44.7833, longitude: -79.9333 },
    "midland, on": { latitude: 44.7500, longitude: -79.8833 },
    "midland, ontario": { latitude: 44.7500, longitude: -79.8833 },
    "coldwater, on": { latitude: 44.7167, longitude: -79.6167 },
    "coldwater, ontario": { latitude: 44.7167, longitude: -79.6167 },
    "orillia, on": { latitude: 44.6068, longitude: -79.4206 },
    "orillia, ontario": { latitude: 44.6068, longitude: -79.4206 },
    "port perry, on": { latitude: 44.1000, longitude: -78.9500 },
    "port perry, ontario": { latitude: 44.1000, longitude: -78.9500 },
    "upton, on": { latitude: 43.9500, longitude: -81.2833 },
    "upton, ontario": { latitude: 43.9500, longitude: -81.2833 },
    "durham, on": { latitude: 44.1667, longitude: -80.8167 },
    "durham, ontario": { latitude: 44.1667, longitude: -80.8167 },
    "markdale, on": { latitude: 44.3167, longitude: -80.6500 },
    "markdale, ontario": { latitude: 44.3167, longitude: -80.6500 },
    "flesherton, on": { latitude: 44.2667, longitude: -80.5500 },
    "flesherton, ontario": { latitude: 44.2667, longitude: -80.5500 },
    "thornbury, on": { latitude: 44.5667, longitude: -80.4500 },
    "thornbury, ontario": { latitude: 44.5667, longitude: -80.4500 },
    "meaford, on": { latitude: 44.6000, longitude: -80.5833 },
    "meaford, ontario": { latitude: 44.6000, longitude: -80.5833 },
    "wiarton, on": { latitude: 44.7333, longitude: -81.1333 },
    "wiarton, ontario": { latitude: 44.7333, longitude: -81.1333 },
    "sauble beach, on": { latitude: 44.6333, longitude: -81.2833 },
    "sauble beach, ontario": { latitude: 44.6333, longitude: -81.2833 },
    "tobermory, on": { latitude: 45.2500, longitude: -81.6667 },
    "tobermory, ontario": { latitude: 45.2500, longitude: -81.6667 },
    "lions head, on": { latitude: 44.9833, longitude: -81.2500 },
    "lions head, ontario": { latitude: 44.9833, longitude: -81.2500 },
    "lion's head, on": { latitude: 44.9833, longitude: -81.2500 },
    "lion's head, ontario": { latitude: 44.9833, longitude: -81.2500 },

    // Quebec (QC)
    "montreal, qc": { latitude: 45.5017, longitude: -73.5673 },
    "montreal, quebec": { latitude: 45.5017, longitude: -73.5673 },
    "quebec city, qc": { latitude: 46.8139, longitude: -71.208 },
    "quebec city, quebec": { latitude: 46.8139, longitude: -71.208 },
    "laval, qc": { latitude: 45.6067, longitude: -73.7123 },
    "laval, quebec": { latitude: 45.6067, longitude: -73.7123 },
    "gatineau, qc": { latitude: 45.4765, longitude: -75.7013 },
    "gatineau, quebec": { latitude: 45.4765, longitude: -75.7013 },
    "longueuil, qc": { latitude: 45.5370, longitude: -73.5103 },
    "longueuil, quebec": { latitude: 45.5370, longitude: -73.5103 },
    "sherbrooke, qc": { latitude: 45.4000, longitude: -71.8994 },
    "sherbrooke, quebec": { latitude: 45.4000, longitude: -71.8994 },
    "saguenay, qc": { latitude: 48.4284, longitude: -71.0684 },
    "saguenay, quebec": { latitude: 48.4284, longitude: -71.0684 },
    "trois-rivières, qc": { latitude: 46.3432, longitude: -72.5433 },
    "trois-rivières, quebec": { latitude: 46.3432, longitude: -72.5433 },
    "trois-rivieres, qc": { latitude: 46.3432, longitude: -72.5433 },
    "trois-rivieres, quebec": { latitude: 46.3432, longitude: -72.5433 },
    "lévis, qc": { latitude: 46.8033, longitude: -71.1779 },
    "lévis, quebec": { latitude: 46.8033, longitude: -71.1779 },
    "levis, qc": { latitude: 46.8033, longitude: -71.1779 },
    "levis, quebec": { latitude: 46.8033, longitude: -71.1779 },
    "terrebonne, qc": { latitude: 45.7000, longitude: -73.6333 },
    "terrebonne, quebec": { latitude: 45.7000, longitude: -73.6333 },
    "saint-jean-sur-richelieu, qc": { latitude: 45.3071, longitude: -73.2626 },
    "saint-jean-sur-richelieu, quebec": { latitude: 45.3071, longitude: -73.2626 },
    "repentigny, qc": { latitude: 45.7422, longitude: -73.4500 },
    "repentigny, quebec": { latitude: 45.7422, longitude: -73.4500 },
    "brossard, qc": { latitude: 45.4500, longitude: -73.4653 },
    "brossard, quebec": { latitude: 45.4500, longitude: -73.4653 },
    "drummondville, qc": { latitude: 45.8833, longitude: -72.4833 },
    "drummondville, quebec": { latitude: 45.8833, longitude: -72.4833 },
    "granby, qc": { latitude: 45.4000, longitude: -72.7333 },
    "granby, quebec": { latitude: 45.4000, longitude: -72.7333 },
    "saint-jérôme, qc": { latitude: 45.7833, longitude: -74.0000 },
    "saint-jérôme, quebec": { latitude: 45.7833, longitude: -74.0000 },
    "saint-jerome, qc": { latitude: 45.7833, longitude: -74.0000 },
    "saint-jerome, quebec": { latitude: 45.7833, longitude: -74.0000 },
    "shawinigan, qc": { latitude: 46.5667, longitude: -72.7500 },
    "shawinigan, quebec": { latitude: 46.5667, longitude: -72.7500 },
    "saint-hyacinthe, qc": { latitude: 45.6308, longitude: -72.9569 },
    "saint-hyacinthe, quebec": { latitude: 45.6308, longitude: -72.9569 },
    "dolbeau-mistassini, qc": { latitude: 48.8833, longitude: -72.2333 },
    "dolbeau-mistassini, quebec": { latitude: 48.8833, longitude: -72.2333 },
    "rouyn-noranda, qc": { latitude: 48.2369, longitude: -79.0231 },
    "rouyn-noranda, quebec": { latitude: 48.2369, longitude: -79.0231 },
    "val-d'or, qc": { latitude: 48.1000, longitude: -77.7833 },
    "val-d'or, quebec": { latitude: 48.1000, longitude: -77.7833 },
    "val d'or, qc": { latitude: 48.1000, longitude: -77.7833 },
    "val d'or, quebec": { latitude: 48.1000, longitude: -77.7833 },
    "joliette, qc": { latitude: 46.0250, longitude: -73.4417 },
    "joliette, quebec": { latitude: 46.0250, longitude: -73.4417 },
    "saint-eustache, qc": { latitude: 45.5667, longitude: -73.9000 },
    "saint-eustache, quebec": { latitude: 45.5667, longitude: -73.9000 },
    "châteauguay, qc": { latitude: 45.3833, longitude: -73.7500 },
    "châteauguay, quebec": { latitude: 45.3833, longitude: -73.7500 },
    "chateauguay, qc": { latitude: 45.3833, longitude: -73.7500 },
    "chateauguay, quebec": { latitude: 45.3833, longitude: -73.7500 },
    "mirabel, qc": { latitude: 45.6500, longitude: -74.0833 },
    "mirabel, quebec": { latitude: 45.6500, longitude: -74.0833 },
    "blainville, qc": { latitude: 45.6667, longitude: -73.8833 },
    "blainville, quebec": { latitude: 45.6667, longitude: -73.8833 },
    "baie-comeau, qc": { latitude: 49.2167, longitude: -68.1500 },
    "baie-comeau, quebec": { latitude: 49.2167, longitude: -68.1500 },
    "sept-îles, qc": { latitude: 50.2167, longitude: -66.3833 },
    "sept-îles, quebec": { latitude: 50.2167, longitude: -66.3833 },
    "sept-iles, qc": { latitude: 50.2167, longitude: -66.3833 },
    "sept-iles, quebec": { latitude: 50.2167, longitude: -66.3833 },
    "rimouski, qc": { latitude: 48.4500, longitude: -68.5167 },
    "rimouski, quebec": { latitude: 48.4500, longitude: -68.5167 },

    // British Columbia (BC)
    "vancouver, bc": { latitude: 49.2827, longitude: -123.1207 },
    "vancouver, british columbia": { latitude: 49.2827, longitude: -123.1207 },
    "surrey, bc": { latitude: 49.1913, longitude: -122.8490 },
    "surrey, british columbia": { latitude: 49.1913, longitude: -122.8490 },
    "burnaby, bc": { latitude: 49.2667, longitude: -122.9667 },
    "burnaby, british columbia": { latitude: 49.2667, longitude: -122.9667 },
    "richmond, bc": { latitude: 49.1667, longitude: -123.1333 },
    "richmond, british columbia": { latitude: 49.1667, longitude: -123.1333 },
    "langley, bc": { latitude: 49.1044, longitude: -122.6581 },
    "langley, british columbia": { latitude: 49.1044, longitude: -122.6581 },
    "coquitlam, bc": { latitude: 49.2833, longitude: -122.7833 },
    "coquitlam, british columbia": { latitude: 49.2833, longitude: -122.7833 },
    "abbotsford, bc": { latitude: 49.0500, longitude: -122.3167 },
    "abbotsford, british columbia": { latitude: 49.0500, longitude: -122.3167 },
    "kelowna, bc": { latitude: 49.8833, longitude: -119.4833 },
    "kelowna, british columbia": { latitude: 49.8833, longitude: -119.4833 },
    "victoria, bc": { latitude: 48.4284, longitude: -123.3656 },
    "victoria, british columbia": { latitude: 48.4284, longitude: -123.3656 },
    "nanaimo, bc": { latitude: 49.1667, longitude: -123.9333 },
    "nanaimo, british columbia": { latitude: 49.1667, longitude: -123.9333 },
    "kamloops, bc": { latitude: 50.6745, longitude: -120.3273 },
    "kamloops, british columbia": { latitude: 50.6745, longitude: -120.3273 },
    "prince george, bc": { latitude: 53.9169, longitude: -122.7494 },
    "prince george, british columbia": { latitude: 53.9169, longitude: -122.7494 },
    "chilliwack, bc": { latitude: 49.1667, longitude: -121.9500 },
    "chilliwack, british columbia": { latitude: 49.1667, longitude: -121.9500 },
    "maple ridge, bc": { latitude: 49.2194, longitude: -122.6019 },
    "maple ridge, british columbia": { latitude: 49.2194, longitude: -122.6019 },
    "north vancouver, bc": { latitude: 49.3167, longitude: -123.0667 },
    "north vancouver, british columbia": { latitude: 49.3167, longitude: -123.0667 },
    "new westminster, bc": { latitude: 49.2067, longitude: -122.9114 },
    "new westminster, british columbia": { latitude: 49.2067, longitude: -122.9114 },
    "port coquitlam, bc": { latitude: 49.2625, longitude: -122.7811 },
    "port coquitlam, british columbia": { latitude: 49.2625, longitude: -122.7811 },
    "west vancouver, bc": { latitude: 49.3667, longitude: -123.1667 },
    "west vancouver, british columbia": { latitude: 49.3667, longitude: -123.1667 },
    "penticton, bc": { latitude: 49.5006, longitude: -119.5858 },
    "penticton, british columbia": { latitude: 49.5006, longitude: -119.5858 },
    "vernon, bc": { latitude: 50.2670, longitude: -119.2720 },
    "vernon, british columbia": { latitude: 50.2670, longitude: -119.2720 },
    "courtenay, bc": { latitude: 49.6881, longitude: -124.9936 },
    "courtenay, british columbia": { latitude: 49.6881, longitude: -124.9936 },
    "campbell river, bc": { latitude: 50.0244, longitude: -125.2475 },
    "campbell river, british columbia": { latitude: 50.0244, longitude: -125.2475 },
    "fort st. john, bc": { latitude: 56.2465, longitude: -120.8476 },
    "fort st. john, british columbia": { latitude: 56.2465, longitude: -120.8476 },
    "fort st john, bc": { latitude: 56.2465, longitude: -120.8476 },
    "fort st john, british columbia": { latitude: 56.2465, longitude: -120.8476 },
    "squamish, bc": { latitude: 49.7017, longitude: -123.1558 },
    "squamish, british columbia": { latitude: 49.7017, longitude: -123.1558 },
    "prince rupert, bc": { latitude: 54.3151, longitude: -130.3208 },
    "prince rupert, british columbia": { latitude: 54.3151, longitude: -130.3208 },
    "dawson creek, bc": { latitude: 55.7596, longitude: -120.2377 },
    "dawson creek, british columbia": { latitude: 55.7596, longitude: -120.2377 },

    // Alberta (AB)
    "calgary, ab": { latitude: 51.0447, longitude: -114.0719 },
    "calgary, alberta": { latitude: 51.0447, longitude: -114.0719 },
    "edmonton, ab": { latitude: 53.5461, longitude: -113.4938 },
    "edmonton, alberta": { latitude: 53.5461, longitude: -113.4938 },
    "red deer, ab": { latitude: 52.2681, longitude: -113.8112 },
    "red deer, alberta": { latitude: 52.2681, longitude: -113.8112 },
    "lethbridge, ab": { latitude: 49.6944, longitude: -112.8328 },
    "lethbridge, alberta": { latitude: 49.6944, longitude: -112.8328 },
    "st. albert, ab": { latitude: 53.6308, longitude: -113.6257 },
    "st. albert, alberta": { latitude: 53.6308, longitude: -113.6257 },
    "st albert, ab": { latitude: 53.6308, longitude: -113.6257 },
    "st albert, alberta": { latitude: 53.6308, longitude: -113.6257 },
    "medicine hat, ab": { latitude: 50.0414, longitude: -110.6781 },
    "medicine hat, alberta": { latitude: 50.0414, longitude: -110.6781 },
    "grande prairie, ab": { latitude: 55.1667, longitude: -118.8000 },
    "grande prairie, alberta": { latitude: 55.1667, longitude: -118.8000 },
    "airdrie, ab": { latitude: 51.2917, longitude: -114.0147 },
    "airdrie, alberta": { latitude: 51.2917, longitude: -114.0147 },
    "spruce grove, ab": { latitude: 53.5450, longitude: -113.9014 },
    "spruce grove, alberta": { latitude: 53.5450, longitude: -113.9014 },
    "fort mcmurray, ab": { latitude: 56.7268, longitude: -111.3810 },
    "fort mcmurray, alberta": { latitude: 56.7268, longitude: -111.3810 },
    "lloydminster, ab": { latitude: 53.2778, longitude: -110.0056 },
    "lloydminster, alberta": { latitude: 53.2778, longitude: -110.0056 },
    "camrose, ab": { latitude: 53.0167, longitude: -112.8167 },
    "camrose, alberta": { latitude: 53.0167, longitude: -112.8167 },
    "brooks, ab": { latitude: 50.5636, longitude: -111.8986 },
    "brooks, alberta": { latitude: 50.5636, longitude: -111.8986 },
    "cold lake, ab": { latitude: 54.4642, longitude: -110.1825 },
    "cold lake, alberta": { latitude: 54.4642, longitude: -110.1825 },
    "wetaskiwin, ab": { latitude: 52.9694, longitude: -113.3769 },
    "wetaskiwin, alberta": { latitude: 52.9694, longitude: -113.3769 },
    "canmore, ab": { latitude: 51.0894, longitude: -115.3581 },
    "canmore, alberta": { latitude: 51.0894, longitude: -115.3581 },
    "banff, ab": { latitude: 51.1784, longitude: -115.5708 },
    "banff, alberta": { latitude: 51.1784, longitude: -115.5708 },
    "jasper, ab": { latitude: 52.8736, longitude: -118.0814 },
    "jasper, alberta": { latitude: 52.8736, longitude: -118.0814 },
    "lethbridge, ab": { latitude: 49.6944, longitude: -112.8328 },
    "lethbridge, alberta": { latitude: 49.6944, longitude: -112.8328 },

    // Manitoba (MB)
    "winnipeg, mb": { latitude: 49.8951, longitude: -97.1384 },
    "winnipeg, manitoba": { latitude: 49.8951, longitude: -97.1384 },
    "brandon, mb": { latitude: 49.8481, longitude: -99.9500 },
    "brandon, manitoba": { latitude: 49.8481, longitude: -99.9500 },
    "steinbach, mb": { latitude: 49.5258, longitude: -96.6839 },
    "steinbach, manitoba": { latitude: 49.5258, longitude: -96.6839 },
    "thompson, mb": { latitude: 55.7433, longitude: -97.8556 },
    "thompson, manitoba": { latitude: 55.7433, longitude: -97.8556 },
    "portage la prairie, mb": { latitude: 49.9728, longitude: -98.2922 },
    "portage la prairie, manitoba": { latitude: 49.9728, longitude: -98.2922 },
    "winkler, mb": { latitude: 49.1817, longitude: -97.9389 },
    "winkler, manitoba": { latitude: 49.1817, longitude: -97.9389 },
    "selkirk, mb": { latitude: 50.1436, longitude: -96.8844 },
    "selkirk, manitoba": { latitude: 50.1436, longitude: -96.8844 },
    "morden, mb": { latitude: 49.1919, longitude: -98.1014 },
    "morden, manitoba": { latitude: 49.1919, longitude: -98.1014 },
    "dauphin, mb": { latitude: 51.1494, longitude: -100.0500 },
    "dauphin, manitoba": { latitude: 51.1494, longitude: -100.0500 },
    "flin flon, mb": { latitude: 54.7681, longitude: -101.8647 },
    "flin flon, manitoba": { latitude: 54.7681, longitude: -101.8647 },

    // Saskatchewan (SK)
    "saskatoon, sk": { latitude: 52.1332, longitude: -106.6700 },
    "saskatoon, saskatchewan": { latitude: 52.1332, longitude: -106.6700 },
    "regina, sk": { latitude: 50.4452, longitude: -104.6189 },
    "regina, saskatchewan": { latitude: 50.4452, longitude: -104.6189 },
    "prince albert, sk": { latitude: 53.2009, longitude: -105.7677 },
    "prince albert, saskatchewan": { latitude: 53.2009, longitude: -105.7677 },
    "moose jaw, sk": { latitude: 50.3931, longitude: -105.5347 },
    "moose jaw, saskatchewan": { latitude: 50.3931, longitude: -105.5347 },
    "swift current, sk": { latitude: 50.2831, longitude: -107.8014 },
    "swift current, saskatchewan": { latitude: 50.2831, longitude: -107.8014 },
    "yorkton, sk": { latitude: 51.2167, longitude: -102.4667 },
    "yorkton, saskatchewan": { latitude: 51.2167, longitude: -102.4667 },
    "north battleford, sk": { latitude: 52.7797, longitude: -108.2967 },
    "north battleford, saskatchewan": { latitude: 52.7797, longitude: -108.2967 },
    "estevan, sk": { latitude: 49.1397, longitude: -102.9858 },
    "estevan, saskatchewan": { latitude: 49.1397, longitude: -102.9858 },
    "weyburn, sk": { latitude: 49.6667, longitude: -103.8500 },
    "weyburn, saskatchewan": { latitude: 49.6667, longitude: -103.8500 },
    "lloydminster, sk": { latitude: 53.2778, longitude: -110.0056 },
    "lloydminster, saskatchewan": { latitude: 53.2778, longitude: -110.0056 },
    "martensville, sk": { latitude: 52.2897, longitude: -106.6675 },
    "martensville, saskatchewan": { latitude: 52.2897, longitude: -106.6675 },
    "warman, sk": { latitude: 52.3167, longitude: -106.5833 },
    "warman, saskatchewan": { latitude: 52.3167, longitude: -106.5833 },

    // Nova Scotia (NS)
    "halifax, ns": { latitude: 44.6488, longitude: -63.5752 },
    "halifax, nova scotia": { latitude: 44.6488, longitude: -63.5752 },
    "dartmouth, ns": { latitude: 44.6713, longitude: -63.5772 },
    "dartmouth, nova scotia": { latitude: 44.6713, longitude: -63.5772 },
    "sydney, ns": { latitude: 46.1368, longitude: -60.1942 },
    "sydney, nova scotia": { latitude: 46.1368, longitude: -60.1942 },
    "truro, ns": { latitude: 45.3650, longitude: -63.2950 },
    "truro, nova scotia": { latitude: 45.3650, longitude: -63.2950 },
    "new glasgow, ns": { latitude: 45.5833, longitude: -62.6333 },
    "new glasgow, nova scotia": { latitude: 45.5833, longitude: -62.6333 },
    "glace bay, ns": { latitude: 46.1969, longitude: -59.9570 },
    "glace bay, nova scotia": { latitude: 46.1969, longitude: -59.9570 },
    "amherst, ns": { latitude: 45.8167, longitude: -64.2167 },
    "amherst, nova scotia": { latitude: 45.8167, longitude: -64.2167 },
    "kentville, ns": { latitude: 45.0775, longitude: -64.4961 },
    "kentville, nova scotia": { latitude: 45.0775, longitude: -64.4961 },
    "bridgewater, ns": { latitude: 44.3783, longitude: -64.5189 },
    "bridgewater, nova scotia": { latitude: 44.3783, longitude: -64.5189 },
    "yarmouth, ns": { latitude: 43.8361, longitude: -66.1175 },
    "yarmouth, nova scotia": { latitude: 43.8361, longitude: -66.1175 },

    // New Brunswick (NB)
    "saint john, nb": { latitude: 45.2733, longitude: -66.0633 },
    "saint john, new brunswick": { latitude: 45.2733, longitude: -66.0633 },
    "st. john, nb": { latitude: 45.2733, longitude: -66.0633 },
    "st. john, new brunswick": { latitude: 45.2733, longitude: -66.0633 },
    "st john, nb": { latitude: 45.2733, longitude: -66.0633 },
    "st john, new brunswick": { latitude: 45.2733, longitude: -66.0633 },
    "moncton, nb": { latitude: 46.0878, longitude: -64.7782 },
    "moncton, new brunswick": { latitude: 46.0878, longitude: -64.7782 },
    "fredericton, nb": { latitude: 45.9636, longitude: -66.6431 },
    "fredericton, new brunswick": { latitude: 45.9636, longitude: -66.6431 },
    "dieppe, nb": { latitude: 46.0989, longitude: -64.6875 },
    "dieppe, new brunswick": { latitude: 46.0989, longitude: -64.6875 },
    "riverview, nb": { latitude: 46.0619, longitude: -64.8056 },
    "riverview, new brunswick": { latitude: 46.0619, longitude: -64.8056 },
    "miramichi, nb": { latitude: 47.0289, longitude: -65.5089 },
    "miramichi, new brunswick": { latitude: 47.0289, longitude: -65.5089 },
    "edmundston, nb": { latitude: 47.3625, longitude: -68.3250 },
    "edmundston, new brunswick": { latitude: 47.3625, longitude: -68.3250 },
    "campbellton, nb": { latitude: 48.0067, longitude: -66.6733 },
    "campbellton, new brunswick": { latitude: 48.0067, longitude: -66.6733 },
    "bathurst, nb": { latitude: 47.6181, longitude: -65.6531 },
    "bathurst, new brunswick": { latitude: 47.6181, longitude: -65.6531 },

    // Newfoundland and Labrador (NL)
    "st. john's, nl": { latitude: 47.5615, longitude: -52.7126 },
    "st. john's, newfoundland and labrador": { latitude: 47.5615, longitude: -52.7126 },
    "st john's, nl": { latitude: 47.5615, longitude: -52.7126 },
    "st john's, newfoundland and labrador": { latitude: 47.5615, longitude: -52.7126 },
    "mount pearl, nl": { latitude: 47.5167, longitude: -52.7833 },
    "mount pearl, newfoundland and labrador": { latitude: 47.5167, longitude: -52.7833 },
    "corner brook, nl": { latitude: 48.9500, longitude: -57.9500 },
    "corner brook, newfoundland and labrador": { latitude: 48.9500, longitude: -57.9500 },
    "conception bay south, nl": { latitude: 47.5000, longitude: -52.9833 },
    "conception bay south, newfoundland and labrador": { latitude: 47.5000, longitude: -52.9833 },
    "grand falls-windsor, nl": { latitude: 48.9333, longitude: -55.6500 },
    "grand falls-windsor, newfoundland and labrador": { latitude: 48.9333, longitude: -55.6500 },
    "gander, nl": { latitude: 48.9569, longitude: -54.6081 },
    "gander, newfoundland and labrador": { latitude: 48.9569, longitude: -54.6081 },
    "happy valley-goose bay, nl": { latitude: 53.3167, longitude: -60.3167 },
    "happy valley-goose bay, newfoundland and labrador": { latitude: 53.3167, longitude: -60.3167 },
    "labrador city, nl": { latitude: 52.9500, longitude: -66.9167 },
    "labrador city, newfoundland and labrador": { latitude: 52.9500, longitude: -66.9167 },

    // Prince Edward Island (PE)
    "charlottetown, pe": { latitude: 46.2382, longitude: -63.1311 },
    "charlottetown, prince edward island": { latitude: 46.2382, longitude: -63.1311 },
    "summerside, pe": { latitude: 46.3956, longitude: -63.7903 },
    "summerside, prince edward island": { latitude: 46.3956, longitude: -63.7903 },
    "stratford, pe": { latitude: 46.2167, longitude: -63.0889 },
    "stratford, prince edward island": { latitude: 46.2167, longitude: -63.0889 },
    "cornwall, pe": { latitude: 46.2267, longitude: -63.2189 },
    "cornwall, prince edward island": { latitude: 46.2267, longitude: -63.2189 },

    // Northwest Territories (NT)
    "yellowknife, nt": { latitude: 62.4540, longitude: -114.3718 },
    "yellowknife, northwest territories": { latitude: 62.4540, longitude: -114.3718 },
    "hay river, nt": { latitude: 60.8156, longitude: -115.7994 },
    "hay river, northwest territories": { latitude: 60.8156, longitude: -115.7994 },
    "inuvik, nt": { latitude: 68.3617, longitude: -133.7306 },
    "inuvik, northwest territories": { latitude: 68.3617, longitude: -133.7306 },
    "fort smith, nt": { latitude: 60.0042, longitude: -111.8889 },
    "fort smith, northwest territories": { latitude: 60.0042, longitude: -111.8889 },

    // Yukon (YT)
    "whitehorse, yt": { latitude: 60.7212, longitude: -135.0568 },
    "whitehorse, yukon": { latitude: 60.7212, longitude: -135.0568 },
    "dawson city, yt": { latitude: 64.0667, longitude: -139.4167 },
    "dawson city, yukon": { latitude: 64.0667, longitude: -139.4167 },
    "watson lake, yt": { latitude: 60.0631, longitude: -128.7089 },
    "watson lake, yukon": { latitude: 60.0631, longitude: -128.7089 },

    // Nunavut (NU)
    "iqaluit, nu": { latitude: 63.7467, longitude: -68.5170 },
    "iqaluit, nunavut": { latitude: 63.7467, longitude: -68.5170 },
    "rankin inlet, nu": { latitude: 62.8069, longitude: -92.0853 },
    "rankin inlet, nunavut": { latitude: 62.8069, longitude: -92.0853 },
    "arviat, nu": { latitude: 61.1086, longitude: -94.0581 },
    "arviat, nunavut": { latitude: 61.1086, longitude: -94.0581 },
    "baker lake, nu": { latitude: 64.3200, longitude: -96.0167 },
    "baker lake, nunavut": { latitude: 64.3200, longitude: -96.0167 },
  };

  const normalizedLocation = location.toLowerCase().trim();
  
  // Try exact match first
  if (locationMap[normalizedLocation]) {
    return locationMap[normalizedLocation];
  }

  // Normalize region abbreviations (ON -> ontario, etc.)
  const regionMap: Record<string, string> = {
    "on": "ontario",
    "qc": "quebec",
    "bc": "british columbia",
    "ab": "alberta",
    "mb": "manitoba",
    "sk": "saskatchewan",
    "ns": "nova scotia",
    "nb": "new brunswick",
    "nl": "newfoundland and labrador",
    "pe": "prince edward island",
    "yt": "yukon",
    "nt": "northwest territories",
    "nu": "nunavut",
  };
  
  // Try to normalize the location string (replace ON with Ontario, etc.)
  let normalized = normalizedLocation;
  for (const [abbr, full] of Object.entries(regionMap)) {
    normalized = normalized.replace(`, ${abbr}`, `, ${full}`);
    normalized = normalized.replace(` ${abbr}`, ` ${full}`);
  }
  
  if (locationMap[normalized] && normalized !== normalizedLocation) {
    return locationMap[normalized];
  }

  // Try partial match (e.g., "toronto" matches "toronto, on")
  // First, try exact city name match
  const locationCity = normalizedLocation.split(",")[0].trim();
  for (const [key, coords] of Object.entries(locationMap)) {
    const keyCity = key.split(",")[0].trim();
    
    // Exact city match (most reliable)
    if (keyCity === locationCity) {
      return coords;
    }
  }
  
  // Then try substring matches (less reliable, but catches variations)
  for (const [key, coords] of Object.entries(locationMap)) {
    const keyCity = key.split(",")[0].trim();
    
    // Check if city names match (case-insensitive substring)
    if (keyCity.includes(locationCity) || locationCity.includes(keyCity)) {
      // Prefer longer matches to avoid false positives
      if (Math.abs(keyCity.length - locationCity.length) <= 2) {
        return coords;
      }
    }
  }

  return null;
}
